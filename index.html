<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BioCycleX</title>
  <meta name="description" content="BioCycleX — Closed-loop textile-to-food platform for Mars and remote ops." />
  <style>
    :root{
      --bg:#f6f0eb;
      --mint:#cdd6cd;
      --ink:#232323;
      --muted:#5a5a5a;
      --card:#ffffff;
      --accent:#2f5f2f;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:'Agrandir',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.5}
    /* Sticky header */
    header{
      position:sticky;top:0;z-index:1000;
      background:var(--mint);
      backdrop-filter:saturate(150%) blur(4px);
      box-shadow:0 2px 10px rgba(0,0,0,.08);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:0 18px}
    .row{display:flex;align-items:center;gap:14px}
    .brand{display:flex;align-items:center;gap:12px;padding:10px 0}
    .brand img{height:42px;width:auto;display:block}
    nav a{color:#0b3d0b;text-decoration:none;font-weight:600;margin:0 10px}
    nav a:hover{opacity:.75}
    main section{padding:40px 0;border-bottom:1px dashed rgba(0,0,0,.08)}
    h1,h2{letter-spacing:.3px;margin:0 0 12px 0}
    h1{font-size:clamp(28px,3.2vw,40px)}
    h2{font-size:clamp(22px,2.4vw,28px)}
    p{margin:8px 0;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:22px}
    @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}
    .card{background:var(--card);border:1px solid rgba(0,0,0,.06);border-radius:16px;padding:18px;box-shadow:0 6px 24px rgba(0,0,0,.04)}
    .kicker{font-size:12px;letter-spacing:.2em;text-transform:uppercase;color:#275127;margin-bottom:6px}
    .flow-img{width:100%;height:auto;border-radius:14px;border:1px solid rgba(0,0,0,.08)}
    .calc-wrap{display:grid;grid-template-columns:1fr;gap:18px}
    @media(min-width:980px){.calc-wrap{grid-template-columns:1fr 1fr}}
    .results{background:#fff;border-radius:16px;border:1px solid rgba(0,0,0,.06);padding:16px}
    .results h3{margin-top:6px}
    .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media(min-width:720px){.stats{grid-template-columns:repeat(3,1fr)}}
    .stat{background:var(--bg);border:1px solid rgba(0,0,0,.06);border-radius:12px;padding:12px;text-align:center}
    small.code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;color:#3a3a3a}
    footer{padding:40px 0;color:#2a2a2a}

    /* Fine details + lists for workflow */
    .fine{font-size:12px;color:#666;margin:6px 4px 0 4px}
    .sub{margin:14px 0 6px 0;font-size:16px}
    .steps{margin:0 0 8px 18px;padding:0;display:grid;gap:6px}
    .steps li{margin:0 0 2px 0}
    .ticks{list-style:"✓  "; margin:0 0 0 18px; display:grid; gap:6px}

    /* Calculator: select + chips */
    .select-row{display:flex;gap:10px;align-items:flex-start}
    #itemSelect{width:100%;min-height:220px;padding:8px;border-radius:12px;border:1px solid rgba(0,0,0,.12);background:#fff}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid rgba(0,0,0,.08);border-radius:999px;padding:6px 10px}
    .chip .x{cursor:pointer;border:none;background:transparent;font-weight:700}
    .chip input[type="number"]{width:70px;padding:4px 6px;border-radius:10px;border:1px solid rgba(0,0,0,.2)}
    .help{font-size:12px;color:#666;margin-top:6px}

    button.primary{
      background:linear-gradient(180deg,#2c6e2c,#1e4f1e);color:#fff;border:none;
      padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer
    }
    button.primary:hover{filter:brightness(1.05)}
  </style>
</head>
<body>
  <header>
    <div class="wrap row brand">
      <img src="assets/BioCycleX.png" alt="BioCycleX logo" />
      <nav class="row" style="margin-left:auto">
        <a href="#calculator">Check out our calculator!</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section id="hero">
      <div class="grid">
        <div class="card">
          <h1>Turning space waste into food and materials</h1>
          <div class="kicker">Who we are</div>
          <p>BioCycleX is an engineering–biotech team that turns space textile waste into glucose syrup via a closed, safe enzymatic process, then converts that glucose into edible or useful products (e.g., nutritional yeast, biogases, PLA precursors). Our system is built for real Mars constraints: minimal water and crew time, no incineration, and low risk.</p>
          <div class="kicker" style="margin-top:16px">Our mission</div>
          <p>We are building a modular, Mars-ready circular system that first targets one of the largest waste streams—fabrics—and converts it into a platform product: glucose. From there, we flexibly route it into nutritional yeast, plant fertilizer, bioplastics (PLA), or fuel components, reducing resupply mass from Earth. From microbe selection to system architecture, we’ve already designed toward future spaceflight compliance—accounting for vibration profiles, g-loads, and microgravity fluid handling—so the platform can be qualified to relevant standards.</p>
          <p>Looking ahead: the approach is expandable to additional waste types. For now, we demonstrate the most immediate chain: textile → sugar → yeast, because it’s fast to grasp and directly useful for the crew.</p>
        </div>

        <!-- Cleaned workflow block -->
        <div>
          <figure class="card">
            <img class="flow-img" src="assets/textil_example_flowchart.png" alt="Workflow turning textiles into glucose and nutritional yeast" loading="lazy" />
            <figcaption class="fine">Example technical workflow — fabrics → sugar → yeast.</figcaption>
          </figure>

          <div class="card">
            <div class="kicker">Example technical workflow — fabrics ≈30% of total inorganic waste</div>
            <p>We treat ~4 kg/day of used textiles (≈75% cotton/cellulose, 21% polyester, 4% nylon) not as trash but as feedstock. Goal: convert one fraction into nutritional yeast and route the rest into useful materials.</p>

            <h3 class="sub">Step by step</h3>
            <ol class="steps">
              <li><strong>Rapid hygiene</strong> — UV-C + mild pasteurization keeps downstream operations clean and safe.</li>
              <li><strong>Shredding & separation</strong> — Fibers are milled, then split into cotton, polyester, and nylon via <em>tribo-electrostatic</em> separation.</li>
              <li><strong>The “sugar factory”</strong> — Cotton (cellulose) enters a bioreactor. Enzymes from friendly microbes cut fibers into glucose (~2.85 kg/day). ~10% of enzymes are recirculated.</li>
              <li><strong>Yeast works</strong> — Glucose is polished and sterilized, then fed (aerobic fed-batch) to grow yeast. Biomass is heat-inactivated and dried → nutritional yeast ~1.35 kg/day, 45–55% protein (~0.6–0.7 kg/day protein).</li>
              <li><strong>The rest</strong> — Nylon diverts to a separate line (e.g., 3D-printing filament). Polyester handling is planned for the next sprint.</li>
            </ol>

            <h3 class="sub">Why this works on Mars</h3>
            <ul class="ticks">
              <li>Low water & crew time, fully closed-loop, no incineration.</li>
              <li>Design considers vibration/shock, g-loads, and microgravity fluid handling for future flight readiness.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- CALCULATOR -->
    <section id="calculator">
      <h2>Wondering how many “space bars” your clothes are worth?</h2>
      <p>Pick items from the list, set quantities, then press <strong>Calculate</strong>. We convert textile cellulose to yeast with <strong>x kg cellulose → 0.456 × x kg nutritional yeast</strong>.</p>

      <div class="calc-wrap">
        <!-- LEFT: inputs -->
        <div class="card">
          <div class="kicker">Choose clothing & textiles</div>
          <div class="select-row">
            <select id="itemSelect" multiple aria-label="Clothing items (hold Ctrl/Cmd to select multiple)"></select>
            <div style="display:flex;flex-direction:column;gap:10px">
              <button class="primary" id="addBtn" type="button">Add selected</button>
              <small class="help">Tip: hold Ctrl/Cmd (or Shift) to select multiple.</small>
            </div>
          </div>

          <div class="kicker" style="margin-top:16px">Selected items</div>
          <div id="chosen" class="chips" aria-live="polite"></div>

          <div style="display:flex;gap:10px;align-items:center;margin-top:16px">
            <button class="primary" id="calcBtn" type="button">Calculate</button>
            <small class="code">Data source: <code>textiles_db.csv</code></small>
          </div>
        </div>

        <!-- RIGHT: results -->
        <div class="results">
          <h3>Results</h3>
          <div id="summary"></div>
          <div class="stats" style="margin-top:12px">
            <div class="stat"><div id="totMass">0</div><small>Total textile mass (kg)</small></div>
            <div class="stat"><div id="totCellulose">0</div><small>Total cellulose (kg)</small></div>
            <div class="stat"><div id="yeastKg">0</div><small>Nutritional yeast (kg)</small></div>
          </div>

          <h3 style="margin-top:16px">Nutrition (batch total)</h3>
          <p class="help" style="margin-top:0">Typical values per 100 g yeast: 1345 kJ / 320 kcal · Fat 4.8 g (sat 1.6 g) · Carbs 9 g (sugars 9 g) · Protein 47 g · Salt 0.5 g</p>
          <div class="stats">
            <div class="stat"><div id="kcal">0</div><small>Total kcal</small></div>
            <div class="stat"><div id="kj">0</div><small>Total kJ</small></div>
            <div class="stat"><div id="proteinG">0</div><small>Protein (g)</small></div>
            <div class="stat"><div id="fatG">0</div><small>Fat (g)</small></div>
            <div class="stat"><div id="satG">0</div><small>Saturates (g)</small></div>
            <div class="stat"><div id="carbG">0</div><small>Carbohydrate (g)</small></div>
            <div class="stat"><div id="sugarG">0</div><small>Sugars (g)</small></div>
            <div class="stat"><div id="saltG">0</div><small>Salt (g)</small></div>
          </div>
        </div>
      </div>
    </section>

    <section id="about">
      <div class="card">
        <div class="kicker">Notes</div>
        <p><strong>Fonts:</strong> The page expects “Agrandir”. You can add a webfont later; meanwhile it falls back to system fonts.</p>
        <p><strong>Assets:</strong> Put <code>assets/BioCycleX.png</code> and <code>assets/textil_example_flowchart.png</code> in the <code>assets/</code> folder next to this file. Keep <code>textiles_db.csv</code> in the repo root.</p>
      </div>
    </section>
  </main>

  <footer class="wrap">
    <div class="row">
      <small>© <span id="year"></span> BioCycleX</small>
    </div>
  </footer>

  <!-- Calculator script -->
  <script>
    const csvPath = './textiles_db.csv';            // keep this next to index.html
    const CACHE_BUSTER = '?v=' + Date.now();        // prevent stale caching on GitHub Pages
    const YEAST_YIELD = 0.456;

    const nutrPer100 = { kcal: 320, kj: 1345, fatG: 4.8, satG: 1.6, carbG: 9, sugarG: 9, proteinG: 47, saltG: 0.5 };

    const el = id => document.getElementById(id);
    const fmt = n => Number(n).toLocaleString(undefined,{maximumFractionDigits:3});

    let DB = [];       // loaded CSV
    let chosen = [];   // {item, mass, frac, qty}

    // Render select from DB
    function renderSelect(){
      const sel = el('itemSelect');
      sel.innerHTML = '';
      DB.forEach((r,i)=>{
        const opt = document.createElement('option');
        opt.value = String(i);
        opt.textContent = `${r.item} — ${r.avg_weight_kg} kg · cellulose ${Math.round(r.cellulose_fraction*100)}%`;
        sel.appendChild(opt);
      });
    }

    // Render chosen chips
    function renderChosen(){
      const box = el('chosen');
      box.innerHTML = '';
      chosen.forEach((c,idx)=>{
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.innerHTML = `
          <span>${c.item}</span>
          <span class="help">${(c.mass).toFixed(3)} kg · ${Math.round(c.frac*100)}% cellulose</span>
          <span>qty</span>
          <input type="number" min="1" step="1" value="${c.qty}" data-idx="${idx}">
          <button class="x" title="Remove" data-rm="${idx}">×</button>
        `;
        box.appendChild(chip);
      });
      // qty change
      box.querySelectorAll('input[type="number"]').forEach(inp=>{
        inp.addEventListener('input', e=>{
          const i = parseInt(e.target.dataset.idx,10);
          chosen[i].qty = Math.max(1, parseInt(e.target.value||'1',10));
        });
      });
      // remove
      box.querySelectorAll('button[data-rm]').forEach(b=>{
        b.addEventListener('click', e=>{
          const i = parseInt(e.target.dataset.rm,10);
          chosen.splice(i,1);
          renderChosen();
        });
      });
    }

    function addSelected(){
      const sel = el('itemSelect');
      const picks = [...sel.selectedOptions].map(o=>DB[parseInt(o.value,10)]);
      picks.forEach(r=>{
        if(!chosen.find(c=>c.item===r.item)){
          chosen.push({item:r.item, mass:+r.avg_weight_kg, frac:+r.cellulose_fraction, qty:1});
        }
      });
      renderChosen();
    }

    function calculate(){
      if(!chosen.length){
        el('summary').innerHTML = '<p>Select at least one item.</p>';
        updateNumbers(0,0,0);
        return;
      }
      const totalMass = chosen.reduce((s,c)=> s + c.qty*c.mass, 0);
      const cellu     = chosen.reduce((s,c)=> s + c.qty*c.mass*c.frac, 0);
      const yeast     = cellu * YEAST_YIELD;

      el('summary').innerHTML =
        '<ul>' + chosen.map(c=>(
          `<li>${c.qty} × ${c.item} — ${(c.qty*c.mass).toFixed(3)} kg textile, ${(c.qty*c.mass*c.frac).toFixed(3)} kg cellulose</li>`
        )).join('') + '</ul>';

      updateNumbers(totalMass, cellu, yeast);
    }

    function updateNumbers(totalMass, cellu, yeast){
      el('totMass').textContent = fmt(totalMass);
      el('totCellulose').textContent = fmt(cellu);
      el('yeastKg').textContent = fmt(yeast);

      const g = yeast * 1000;
      const f = g/100;
      el('kcal').textContent     = fmt(nutrPer100.kcal*f);
      el('kj').textContent       = fmt(nutrPer100.kj*f);
      el('proteinG').textContent = fmt(nutrPer100.proteinG*f);
      el('fatG').textContent     = fmt(nutrPer100.fatG*f);
      el('satG').textContent     = fmt(nutrPer100.satG*f);
      el('carbG').textContent    = fmt(nutrPer100.carbG*f);
      el('sugarG').textContent   = fmt(nutrPer100.sugarG*f);
      el('saltG').textContent    = fmt(nutrPer100.saltG*f);
    }

    // CSV load with fallback
    function parseCSV(text){
      const [head, ...rows] = text.trim().split(/\r?\n/);
      const cols = head.split(',').map(s=>s.trim());
      return rows.map(line=>{
        const cells = line.split(',').map(s=>s.trim());
        const o = {};
        cols.forEach((c,i)=> o[c] = isNaN(parseFloat(cells[i])) ? cells[i] : parseFloat(cells[i]) );
        return o;
      });
    }

    const FALLBACK_DATA = [
      {"item":"T-shirt","avg_weight_kg":0.18,"cellulose_fraction":0.75},
      {"item":"Shirt","avg_weight_kg":0.20,"cellulose_fraction":0.75},
      {"item":"Jeans","avg_weight_kg":0.60,"cellulose_fraction":0.90},
      {"item":"Pants","avg_weight_kg":0.50,"cellulose_fraction":0.75},
      {"item":"Hoodie","avg_weight_kg":0.55,"cellulose_fraction":0.70},
      {"item":"Dress","avg_weight_kg":0.35,"cellulose_fraction":0.70},
      {"item":"One pair of socks","avg_weight_kg":0.06,"cellulose_fraction":0.75},
      {"item":"Underwear","avg_weight_kg":0.05,"cellulose_fraction":0.75},
      {"item":"Towel","avg_weight_kg":0.40,"cellulose_fraction":0.90},
      {"item":"Bedsheet (single)","avg_weight_kg":0.50,"cellulose_fraction":1.00},
      {"item":"Tissue","avg_weight_kg":0.005,"cellulose_fraction":1.00}
    ];

    async function loadData(){
      try{
        const res = await fetch(csvPath + CACHE_BUSTER, {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const txt = await res.text();
        const arr = parseCSV(txt);
        if(!arr.length) throw new Error('Empty CSV');
        return arr;
      }catch(e){
        console.warn('CSV load failed, using fallback.', e);
        return FALLBACK_DATA;
      }
    }

    // Boot
    document.getElementById('addBtn').addEventListener('click', addSelected);
    document.getElementById('calcBtn').addEventListener('click', calculate);
    document.getElementById('year').textContent = new Date().getFullYear();

    loadData().then(data=>{
      DB = data;
      renderSelect();
    });
  </script>
</body>
</html>
